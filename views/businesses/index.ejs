<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Businesses</title>
</head>

<body>
    <h1>All Businesses</h1>
    <a href="/business/new">Add Business</a>

    <!-- 정렬을 위한 드롭다운 메뉴 -->
    <div>
        <label for="sort-options">Sort by:</label>
        <select name="sort" id="sort-options" onchange="sortBusinesses()">
            <option value="a-z">A-Z</option>
            <option value="z-a">Z-A</option>
            <option value="rating-desc">High to Low</option>
            <option value="rating-asc">Low to High</option>
        </select>
    </div>

    <!-- 검색을 위한 입력창 -->
    <div>
        <label for="search">Search:</label>
        <input type="text" id="search" onkeyup="searchBusinesses()">
    </div>

    <!-- 가게 목록 -->
    <ul id="business-list">
        <% for (let b of business){%>
        <li class="business-item" data-title="<%= b.title.toLowerCase() %>" data-rating="<%= b.averageRating %>">
            <a href="/business/<%= b._id %>"><%= b.title %></a> - <%= b.averageRating %> &#9733;
        </li>
        <% }%>
    </ul>

    <!-- 정렬 및 검색 로직을 담은 JavaScript 함수 -->
    <script>
        function sortBusinesses() {
            const sortValue = document.getElementById('sort-options').value;
            const list = document.getElementById('business-list');
            const items = list.querySelectorAll('.business-item');

            const itemsArray = Array.from(items);

            itemsArray.sort((a, b) => {
                if (sortValue === 'a-z') {
                    return a.dataset.title.localeCompare(b.dataset.title);
                } else if (sortValue === 'z-a') {
                    return b.dataset.title.localeCompare(a.dataset.title);
                } else if (sortValue === 'rating-desc') {
                    return parseFloat(b.dataset.rating) - parseFloat(a.dataset.rating);
                } else if (sortValue === 'rating-asc') {
                    return parseFloat(a.dataset.rating) - parseFloat(b.dataset.rating);
                }
            });
            
            itemsArray.forEach(item => {
                list.appendChild(item);
            });
        }

        function searchBusinesses() {
            const searchTerm = document.getElementById('search').value.toLowerCase();
            const items = document.querySelectorAll('.business-item');

            items.forEach(item => {
                const title = item.dataset.title;
                
                if (title.includes(searchTerm)) {
                    item.style.display = ''; 
                } else {
                    item.style.display = 'none';
                }
            });
        }
    </script>
</body>

</html>
